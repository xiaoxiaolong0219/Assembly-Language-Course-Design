# 唐都实验箱-课程设计

## 项目简介

本项目是在唐都实验箱上实现的俄罗斯方块游戏，采用 x86 汇编语言编写。游戏具有完整的游戏逻辑、速度控制、分数显示等功能，展示了微机原理与接口技术的综合应用。

## 硬件环境

- **实验平台**：唐都 TD-PIT+ 微机原理与接口技术实验箱
- **核心硬件**：
  - 16×16 LED 点阵显示屏
  - 8255 可编程并行接口芯片
  - 4×4 矩阵键盘
  - 7段数码管
  - 拨码开关（K0-K3）

## 硬件接口说明

### LED 点阵接口
| 端口地址 | 功能 |
|---------|------|
| 0600H | 行选控制（ROW1，行0-7） |
| 0640H | 行选控制（ROW2，行8-15） |
| 0680H | 列选控制（COL1，列0-7） |
| 06C0H | 列选控制（COL2，列8-15） |

### 8255 接口
| 端口地址 | 功能 |
|---------|------|
| 0620H | A口输出：数码管位选 + 键盘列扫描 |
| 0622H | B口输出：数码管段码 |
| 0624H | C口输入：低4位键盘行扫，高4位开关输入 |
| 0626H | 控制口 |

## 功能特性

### 游戏功能
- 7种经典俄罗斯方块形状（I、O、T、S、Z、J、L）
- 方块旋转（4个方向）
- 左右移动控制
- 自动下落
- 边界碰撞检测
- 方块堆叠与固定
- 消行检测与消除

### 操作控制
| 按键 | 功能 |
|------|------|
| C键 | 开始游戏 / 重新开始 |
| D键 | 方块左移 |
| E键 | 方块右移 |
| F键 | 退出游戏 |

### 速度控制
| 开关 | 功能 |
|------|------|
| K0（PC4） | 加速下降 |
| K1（PC5） | 减速下降 |
| K2（PC6） | 保留 |
| K3（PC7） | 保留 |

### 速度级别
| 级别 | 速度描述 | 下落延时 |
|------|---------|---------|
| 0 | 慢速 | 500ms |
| 1 | 中速 | 300ms |
| 2 | 快速 | 150ms |
| 3 | 超快 | 50ms |

### 显示功能
- **16×16 LED 点阵**：显示游戏画面和边框
- **7段数码管**：显示方块计数（0-99）
  - 个位：显示在右边数码管
  - 十位：显示在左边数码管

## 文件说明

| 文件名 | 说明 |
|--------|------|
| `tetris.asm` | 俄罗斯方块游戏主程序源代码 |

## 使用说明

### 编译环境
- MASM 6.11 或更高版本
- TD.EXE 调试器（可选）

### 编译步骤
```bash
ml tetris.asm
link tetris.obj
```

### 运行步骤
1. 将生成的 `tetris.exe` 下载到唐都实验箱
2. 在实验箱上运行程序
3. 按下 **C键** 开始游戏
4. 使用 **D/E键** 控制方块左右移动
5. 使用 **K0/K1开关** 调节游戏速度

## 游戏规则

1. 按下 **C键** 开始游戏
2. 方块自动下落，玩家可以左右移动调整位置
3. 当一行被填满时，该行消除，上方方块下移
4. 当新方块生成时立即发生碰撞，游戏结束
5. 分数达到 100 时游戏结束
6. 按下 **F键** 可随时退出游戏

## 技术细节

### 8255 初始化
```
控制字：89H
- A口：输出（数码管位选 + 键盘列扫描）
- B口：输出（数码管段码）
- C口：输入（低4位键盘行，高4位开关）
```

### 键盘扫描原理
采用矩阵扫描方式：
1. A口逐列输出扫描信号（0xFE → 0xFD → 0xFB → 0xF7）
2. C口低4位读取行状态
3. 根据列号和行号确定按键值

### LED 点阵显示原理
采用动态扫描方式：
1. 逐行选择（ROW1/ROW2）
2. 同时输出列数据（COL1/COL2）
3. 快速刷新（约16行/frame）实现完整显示

### 随机数生成
使用线性同余法：
```
种子 = (种子 × 25173 + 13849) mod 65536
```

## 注意事项

1. **硬件连接**：确保实验箱各模块连接正确
2. **端口地址**：根据实际实验箱配置检查端口地址
3. **开关操作**：拨动开关后需稳定一段时间才能生效
4. **游戏结束**：分数达到100或方块堆叠至顶部时游戏结束

## 作者信息

- **课程**：微机原理与接口技术
- **实验平台**：唐都 TD-PIT+ 实验箱
- **编程语言**：x86 汇编语言 (8086/8088)

## 许可证

本项目仅供学习交流使用。
